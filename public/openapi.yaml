openapi: 3.0.3
info:
  title: Tienda Cats - API (documentación completa)
  version: 1.2.0
  description: |
    Documentación completa de la API de Tienda Cats. Incluye endpoints para:
    - Visualizar y comprar productos
    - Gestionar carrito de compras
    - Autenticación de usuarios
    - Gestión de usuarios y productos (solo admin)
servers:
  - url: http://localhost:5173
    description: Servidor de desarrollo (Vite)
  - url: http://localhost:3000
    description: Alternativo
security:
  - bearerAuth: []
paths:
  /data/productos.json:
    get:
      tags:
        - Productos Públicos
      summary: Obtener lista de productos (estático)
      description: Devuelve el JSON estático de productos disponibles en la tienda.
      security: []
      responses:
        '200':
          description: Lista de productos
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Product'

  /api/productos:
    get:
      tags:
        - Productos Públicos
      summary: Obtener todos los productos
      description: Obtiene la lista completa de productos disponibles (público).
      security: []
      responses:
        '200':
          description: Lista de todos los productos
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Product'

  /api/productos/{id}:
    get:
      tags:
        - Productos Públicos
      summary: Obtener producto por id
      description: Obtiene los detalles de un producto específico.
      security: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID del producto
      responses:
        '200':
          description: Detalles del producto
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '404':
          description: Producto no encontrado

  /api/carrito:
    get:
      tags:
        - Carrito de Compras
      summary: Obtener carrito del usuario
      description: Obtiene el carrito del usuario autenticado (desde Firestore o localStorage).
      responses:
        '200':
          description: Carrito del usuario
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cart'
        '401':
          description: No autenticado

  /api/carrito/agregar:
    post:
      tags:
        - Carrito de Compras
      summary: Agregar producto al carrito
      description: Agrega un producto al carrito o incrementa su cantidad en 1.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: string
                  example: product1
                nombre:
                  type: string
                  example: Alimento Premium
                precio:
                  type: number
                  example: 8990
                imagen:
                  type: string
                  example: /assets/alimento.png
              required:
                - id
                - nombre
                - precio
      responses:
        '200':
          description: Producto agregado al carrito
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cart'

  /api/carrito/decrementar/{id}:
    post:
      tags:
        - Carrito de Compras
      summary: Decrementar cantidad de producto
      description: Reduce la cantidad de un producto en el carrito. Si llega a 0, se elimina.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Carrito actualizado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cart'

  /api/carrito/eliminar/{id}:
    post:
      tags:
        - Carrito de Compras
      summary: Eliminar producto del carrito
      description: Elimina completamente un producto del carrito.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Producto eliminado

  /api/carrito/vaciar:
    post:
      tags:
        - Carrito de Compras
      summary: Vaciar carrito
      description: Elimina todos los productos del carrito.
      responses:
        '200':
          description: Carrito vaciado

  /api/carrito/comprar:
    post:
      tags:
        - Carrito de Compras
      summary: Realizar compra
      description: Registra la compra como una orden en Firestore y vacía el carrito.
      responses:
        '201':
          description: Compra realizada exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '401':
          description: No autenticado

  /api/auth/login:
    post:
      tags:
        - Autenticación
      summary: Iniciar sesión
      description: Autentica un usuario con email y contraseña.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  example: usuario@example.com
                password:
                  type: string
                  example: miContraseña123
              required:
                - email
                - password
      responses:
        '200':
          description: Autenticación correcta
          content:
            application/json:
              schema:
                type: object
                properties:
                  isAdmin:
                    type: boolean
                    example: false
        '401':
          description: Credenciales inválidas

  /api/auth/register:
    post:
      tags:
        - Autenticación
      summary: Registrar nuevo usuario
      description: Crea una nueva cuenta de usuario en la plataforma.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreate'
      responses:
        '201':
          description: Usuario creado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Email ya registrado o datos inválidos

  /api/auth/logout:
    post:
      tags:
        - Autenticación
      summary: Cerrar sesión
      description: Cierra la sesión del usuario autenticado.
      responses:
        '200':
          description: Sesión cerrada

  /api/usuarios:
    get:
      tags:
        - Usuarios
      summary: Listar todos los usuarios
      description: Lista todos los usuarios registrados. Solo para administradores.
      responses:
        '200':
          description: Lista de usuarios
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '403':
          description: No es administrador

  /api/usuarios/{id}:
    get:
      tags:
        - Usuarios
      summary: Obtener usuario por id
      description: Obtiene los detalles de un usuario específico.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Detalles del usuario
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: Usuario no encontrado

  /api/admin/productos:
    get:
      tags:
        - Admin - Productos
      summary: Listar productos (admin)
      description: Lista todos los productos. Solo para administradores.
      responses:
        '200':
          description: Lista de productos
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Product'
        '403':
          description: No es administrador
    post:
      tags:
        - Admin - Productos
      summary: Crear nuevo producto
      description: Crea un nuevo producto en la tienda. Solo para administradores.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductCreate'
      responses:
        '201':
          description: Producto creado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '403':
          description: No es administrador

  /api/admin/productos/{id}:
    get:
      tags:
        - Admin - Productos
      summary: Obtener producto (admin)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Detalles del producto
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '403':
          description: No es administrador
        '404':
          description: Producto no encontrado
    put:
      tags:
        - Admin - Productos
      summary: Actualizar producto
      description: Actualiza los datos de un producto existente. Solo para administradores.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductUpdate'
      responses:
        '200':
          description: Producto actualizado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '403':
          description: No es administrador
        '404':
          description: Producto no encontrado
    delete:
      tags:
        - Admin - Productos
      summary: Eliminar producto
      description: Elimina un producto de la tienda. Solo para administradores.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Producto eliminado
        '403':
          description: No es administrador
        '404':
          description: Producto no encontrado

  /api/admin/usuarios:
    get:
      tags:
        - Admin - Usuarios
      summary: Listar usuarios (admin)
      description: Lista todos los usuarios registrados. Solo para administradores.
      responses:
        '200':
          description: Lista de usuarios
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '403':
          description: No es administrador

  /api/admin/usuarios/{id}:
    put:
      tags:
        - Admin - Usuarios
      summary: Cambiar rol de usuario
      description: Promueve o revoca permisos de admin a un usuario. Solo para administradores.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                isAdmin:
                  type: boolean
                  example: true
      responses:
        '200':
          description: Rol actualizado
        '403':
          description: No es administrador
    delete:
      tags:
        - Admin - Usuarios
      summary: Eliminar usuario
      description: Elimina un usuario y su carrito asociado. Solo para administradores.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Usuario eliminado
        '403':
          description: No es administrador
        '404':
          description: Usuario no encontrado

  /api/admin/ordenes:
    get:
      tags:
        - Admin - Órdenes
      summary: Listar órdenes/compras
      description: Lista todas las órdenes registradas. Solo para administradores.
      responses:
        '200':
          description: Lista de órdenes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Order'
        '403':
          description: No es administrador

  /api/admin/ordenes/{id}:
    delete:
      tags:
        - Admin - Órdenes
      summary: Eliminar orden
      description: Elimina una orden del historial. Solo para administradores.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Orden eliminada
        '403':
          description: No es administrador
        '404':
          description: Orden no encontrada

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Token JWT de autenticación Firebase

  schemas:
    Product:
      type: object
      properties:
        id:
          type: string
          example: "1"
          description: Identificador del producto
        nombre:
          type: string
          example: Alimento Premium
        precio:
          type: number
          example: 8990
          description: Precio en pesos chilenos
        categoria:
          type: string
          example: alimento
          enum:
            - alimento
            - juguete
            - accesorio
        imagen:
          type: string
          example: /assets/alimento.png
          description: URL o ruta relativa de la imagen
        descripcion:
          type: string
          example: Alimento completo para gatos adultos.
        destacado:
          type: boolean
          example: true
          description: Si el producto aparece destacado en la tienda
      required:
        - id
        - nombre
        - precio

    ProductCreate:
      type: object
      properties:
        nombre:
          type: string
          example: Juguete Ratón
        precio:
          type: number
          example: 3990
        categoria:
          type: string
          example: juguete
          enum:
            - alimento
            - juguete
            - accesorio
        imagen:
          type: string
          example: /assets/juguete.jpg
        descripcion:
          type: string
          example: Ratón de felpa con catnip
        destacado:
          type: boolean
          example: false
      required:
        - nombre
        - precio

    ProductUpdate:
      type: object
      properties:
        nombre:
          type: string
        precio:
          type: number
        categoria:
          type: string
          enum:
            - alimento
            - juguete
            - accesorio
        imagen:
          type: string
        descripcion:
          type: string
        destacado:
          type: boolean

    User:
      type: object
      properties:
        id:
          type: string
          example: user123abc
          description: ID único del usuario en Firebase
        nombre:
          type: string
          example: Juan Pérez
        email:
          type: string
          example: juan@example.com
        isAdmin:
          type: boolean
          example: false
          description: Indica si el usuario tiene permisos de administrador
      required:
        - id
        - email

    UserCreate:
      type: object
      properties:
        nombre:
          type: string
          example: María García
        email:
          type: string
          example: maria@example.com
        password:
          type: string
          example: miContraseña123
      required:
        - email
        - password

    Cart:
      type: object
      properties:
        items:
          type: object
          description: Productos en el carrito
          additionalProperties:
            type: object
            properties:
              id:
                type: string
              nombre:
                type: string
              precio:
                type: number
              imagen:
                type: string
              qty:
                type: integer
                description: Cantidad del producto
          example:
            product1:
              id: "1"
              nombre: Alimento Premium
              precio: 8990
              imagen: /assets/alimento.png
              qty: 2
            product2:
              id: "2"
              nombre: Juguete Ratón
              precio: 3990
              imagen: /assets/juguete.jpg
              qty: 1

    Order:
      type: object
      properties:
        id:
          type: string
          example: order123abc
          description: ID único de la orden
        buyer:
          type: string
          example: cliente@example.com
          description: Email del comprador
        items:
          type: object
          description: Productos comprados
        total:
          type: number
          example: 25960
          description: Monto total de la compra
        createdAt:
          type: string
          format: date-time
          example: "2025-12-04T10:30:00Z"
      required:
        - id
        - buyer
        - items
        - total
